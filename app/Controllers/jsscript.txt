
<script>
var item={};
var items=[];
$("#submit").click(function (e) {
    e.preventDefault();
    if(validator()!=true){
        console.log("here2");
        alert('Fill in all missing Fields');
        return null;
    }
    item={
        serial: $("#sn").val(),
        description: $("#description").val(),
        quantity: $("#quantity").val(),
        unitPrice: $("#unitPrice").val(),
        total: $("#quantity").val()*$("#unitPrice").val()
    }
    items.push(item);
    item={};
    reverter();
    populator();
    console.log(items);
});
function validator(){
    if(($("#sn").val())&&
        ($("#description").val())&&
        ($("#quantity").val())&&
        ($("#unitPrice").val()))
    {
        return true;
    }else{
        return false;
    }
}
function reverter(){
    $("#sn").val('');
    $("#description").val('');
    $("#quantity").val('');
    $("#unitPrice").val('');
    return ;
}
function populator(){
    tableClear();
    if(items!=null){
        $.each(items, function (i, v) {
             $("#tbody").append("<tr><td>"+v.serial+"</td><td>"+v.description+"</td><td>"+v.quantity+"</td><td>"+v.unitPrice+"</td><td>"+v.total+"</td><td><a href='#' onClick='remove("+i+")' class='btn btn-danger'>Remove</a></td></tr>");
        });
    }
}
function tableClear(){
    $("#tbody").empty();
}
function remove(i){
    items.splice(i,1);
    populator();
    return;
}
$("#save").click(function (e) {
    e.preventDefault();
    if(items.length<=0){
        alert('Please Add some Invoice items');
        return;
    }
    var url="<?=base_url('invoices/invoice_items_save/'.$invoice_no)?>";
    var data=JSON.stringify(items);
    $("#alerter").append('<div class="alert alert-primary alert-dismissible fade show" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Loading....</strong> Communicating with server..</div>');
    $.post(url, data,
        function (data, textStatus, jqXHR) {
            if(data.success){
                $("#save").attr("disabled", true);
                $("#alerter").append('<div class="alert alert-success alert-dismissible fade show" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Success!!</strong> '+data.message+'</div>');
                setTimeout(() => {
                    window.location.href="<?=base_url('invoices')?>";
                }, 2000);
            }else{
                $("#alerter").append('<div class="alert alert-danger alert-dismissible fade show" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Error!!</strong> '+data.message+'</div>');
            }
        },
        "JSON"
    );
});
</script>
